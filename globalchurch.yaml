# This file defines the Global Church Schema, which includes classes and slots for users and churches.
# It uses UUIDs for unique identifiers and includes various properties for user and church information.
# This schema is designed to facilitate data management for the Global.Church ecosystem.
# Generated with LinkML: https://linkml.io/linkml/


id: https://global.church/schema
name: GlobalChurch

imports:
  - linkml:types

types:
  uuid:
    base: str
    uri: xsd:string
    description: "Universally unique identifier (RFC 4122)."
    pattern: '^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$'

  email:
    base: str
    uri: xsd:string
    description: "Email address (simplified RFC 5322)."
    # allow common local@domain.tld addresses; intentionally conservative
    pattern: '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$'

  phone_e164:
    base: str
    uri: xsd:string
    description: "Telephone number in E.164 format with optional leading +."
    # e.g., +14155552671 (max 15 digits)
    pattern: '^\+?[1-9]\d{1,14}$'

prefixes:
  linkml: https://w3id.org/linkml/
  gc: https://global.church/schema/
  schema: http://schema.org/

subsets:
  church_core:
    description: "Minimal fields needed to represent a church."
  user_core:
    description: "Minimal fields needed to represent a user."
  public:
    description: "Fields available for public consumption."
  internal:
    description: "Operational/internal fields for Global.Church."
  enrichment:
    description: "Usually derived by AI or post-processing."
  overture:
    description: "Sourced from Overture Maps."
  pii:
    description: "Potentially personally identifiable or sensitive."

default_prefix: gc
default_range: string

classes:
  User:
    description: "A registered platform user."
    mappings: [schema:Person]
    slots:
      - user_id
      - given_name
      - family_name
      - email
      - telephone
      - skills
      - primary_church
      - alternate_church
      - interests
      - faith_journey
    in_subset: [user_core, public]
    
  Church:
    description: "A distinct church congregation."
    mappings:
      - schema:Church            # The physical worship place
      - schema:Organization      # The entity that runs it
    slots:
      - church_id
      - gers_id
      - name
      - pipeline_status
      - latitude
      - longitude
      - address
    in_subset: [church_core, public]
  
  ChurchWebsite:
    description: "Raw scrape artifacts captured from the church root URL."
    slots:
      - church_id
      - root_scrape_text
      - root_scrape_buttons
      - root_scrape_check
      - root_candidates
      - candidates_text_and_links
    in_subset: [internal]

  EnrichedData:
    description: "AI-enriched attributes extracted from the church website and socials."
    slots:
      - church_id
      - service_times
      - church_beliefs_url
      - trinitarian_beliefs
      - belief_type
      - scraped_email
      - instagram_url
      - youtube_url
      - service_languages
      - scraped_address
      - programs_offered
      - church_summary
    in_subset: [public, enrichment]

  Overture:
    description: "Original place record as supplied by Overture Maps."
    slots:
      - gers_id
      - version
      - source
      - confidence
      - source_release
    in_subset: [overture]

slots:
  user_id:
    identifier: true
    exact_mappings: [schema:identifier]
    range: uuid
    description: "Primary key for User (also referenced by other tables)."
    in_subset: [public, user_core]

  given_name:
    exact_mappings: [schema:givenName]
    description: "First name."
    in_subset: [user_core, pii]

  family_name:
    exact_mappings: [schema:familyName]
    description: "Last name."
    in_subset: [user_core, pii]

  email:
    exact_mappings: [schema:email]
    range: email
    description: "Main contact email."
    in_subset: [user_core, internal, pii]

  telephone:
    exact_mappings: [schema:telephone]
    range: phone_e164
    description: "Phone number (international format recommended)."
    in_subset: [internal, pii]

  skills:
    exact_mappings: [schema:skills] 
    description: "Comma-separated list of user skills."
    in_subset: [internal]

  primary_church:
    range: uuid
    description: "FK → Church.church_id (the user’s primary church)."
    in_subset: [internal]

  alternate_church:
    range: uuid
    description: "Optional FK → Church.church_id (secondary church)."
    in_subset: [internal]

  interests:
    exact_mappings: [schema:interest]
    description: "Free-text interests or ministry areas."
    in_subset: [internal]

  faith_journey:
    description: "Narrative text describing the user’s faith journey."
    in_subset: [internal]

  church_id:
    identifier: true
    range: uuid
    description: "Primary key for Church; referenced by related tables. Issued by Global.Church."
    in_subset: [church_core, public]

  name:
    exact_mappings: [schema:name]
    description: "Official church name."
    in_subset: [church_core, public]

  pipeline_status:
    range: string
    description: "Enrichment pipeline stage (e.g., RAW, CLEAN, ENRICHED, VALIDATED)."
    in_subset: [internal]

  latitude:
    range: float
    exact_mappings: [schema:latitude]
    description: "Geographic latitude (decimal degrees)."
    in_subset: [church_core, public]

  longitude:
    range: float
    exact_mappings: [schema:longitude]
    description: "Geographic longitude (decimal degrees)."
    in_subset: [church_core, public]

  address:
    range: string
    exact_mappings: [schema:address]
    description: "Physical street address."
    in_subset: [church_core, public]

  locality:
    exact_mappings: [schema:addressLocality]
    description: "City or locality of the church."
    in_subset: [church_core, public]

  region:
    exact_mappings: [schema:addressRegion]
    description: "State, province, or region."
    in_subset: [church_core, public]

  postal_code:
    exact_mappings: [schema:postalCode]
    description: "Postal / ZIP code."
    in_subset: [church_core, public]

  country:
    exact_mappings: [schema:addressCountry]
    description: "ISO-3166 country code."
    in_subset: [church_core, public]

  website:
    exact_mappings: [schema:url]
    range: uri
    description: "Full website URL."
    in_subset: [public]

  website_root:
    range: uri
    description: "Root URL (scheme + domain)."
    in_subset: [internal]

  search_blob:
    description: "Concatenated text blob used for full-text search."
    in_subset: [internal]

  opening_hours:
    exact_mappings: [schema:openingHours, schema:openingHoursSpecification]
    description: "Opening hours information."
    in_subset: [public]

  keywords:
    exact_mappings: [schema:keywords]
    description: "Comma-separated keywords or tags."
    in_subset: [public]

  alternate_name:
    exact_mappings: [schema:alternateName]
    description: "Alternate or colloquial church name."
    in_subset: [public]

  description:
    exact_mappings: [schema:description]
    description: "Long-form description of the church."
    in_subset: [public, enrichment]

  social_media:
    description: "JSON or comma-separated social media handles. Provided by Overture Maps."
    in_subset: [public, overture, enrichment]

  phone:
    exact_mappings: [schema:telephone]
    range: phone_e164
    description: "Church phone number."
    in_subset: [public, overture, enrichment]

  root_scrape_text:
    description: "Visible text scraped from the root page."
    in_subset: [internal]

  root_scrape_buttons:
    description: "Button texts captured on root page."
    in_subset: [internal]

  root_scrape_check:
    description: "Checksum or status flag of the scrape."
    in_subset: [internal]

  root_candidates:
    description: "Candidate URLs extracted from the root page."
    in_subset: [internal]

  candidates_text_and_links:
    description: "Text and associated links for candidate pages."
    in_subset: [internal]

  service_times:
    description: "Service times (free text)."
    in_subset: [public, enrichment]

  church_beliefs_url:
    range: uri
    description: "URL of the statement of faith or similar statement of beliefs."
    in_subset: [public, enrichment]

  trinitarian_beliefs:
    range: boolean
    description: "True if church affirms classical Trinitarian doctrine."
    in_subset: [public, enrichment]

  belief_type:
    range: BeliefTypeEnum
    description: |
      Denomination / church type category.  
      This slot classifies a church into one of several top-level Christian family groupings
      as defined by the BeliefTypeEnum.  
      Based on the Harvest Information Standards (HIS) Registry of Religions.
    in_subset: [public, enrichment]

  scraped_email:
    exact_mappings: [schema:email]
    range: email
    description: "Email address extracted from site."
    in_subset: [internal, pii, enrichment]

  instagram_url:
    exact_mappings: [schema:sameAs]
    range: uri
    description: "Instagram profile URL."
    in_subset: [public, enrichment]

  youtube_url:
    exact_mappings: [schema:sameAs]
    range: uri
    description: "YouTube channel URL."
    in_subset: [public, enrichment]

  service_languages:
    exact_mappings: [schema:inLanguage]
    description: "Languages in which services are offered."
    in_subset: [public, enrichment]

  scraped_address:
    exact_mappings: [schema:address]
    description: "Postal address extracted from site."
    in_subset: [public, enrichment]

  programs_offered:
    exact_mappings: [schema:service]
    description: "List of programs or ministries offered."
    in_subset: [public, enrichment]

  church_summary:
    description: "Concise summary of the church, including key attributes and offerings."
    in_subset: [public, enrichment]

  # --- Overture slots ---
  version:
    range: integer
    description: "Overture version number."
    in_subset: [overture]

  source:
    description: "Source label of the Overture record."
    in_subset: [overture]

  confidence:
    range: float
    description: "Confidence score (0–1)."
    in_subset: [overture]

  source_release:
    description: "Overture release tag (e.g., 2024-05-15)."
    in_subset: [overture]

  gers_id:
    description: "ID from the Government/Ecclesiastical Registry System (if available)."
    in_subset: [overture, public]


enums:
  BeliefTypeEnum:
    description: "Top-level Christian family grouping used by Global.Church. 
                  Based on Harvest Information Standards (HIS) Registry of Religions. 
                  https://hisregistries.org/ror/"
    permissible_values:
      orthodox:
        aliases: ["Orthodox"]
        description: "Eastern Orthodox and Oriental Orthodox churches."
      roman_catholic:
        aliases: ["Roman Catholic"]
        description: "Roman Catholic Church."
      protestant:
        aliases: ["Protestant"]
        description: "Protestant denominations."
      anglican:
        aliases: ["Anglican"]
        description: "Anglican Communion and related churches."
      other:
        aliases: ["Other"]
        description: "Any other Trinitarian Christian tradition not listed above. Similar to 'Independent' in HIS."
      unknown:
        aliases: ["Unknown"]
        description: "Belief type has not been determined."